language: python

stages:
  - test
  - build
  - coverage
  - deploy

install:
  - pip install -r requirements.txt
  - pip install .
  - pip install codecov

script: python -m pytest

after_success:
  - codecov

jobs:
  include:
    - stage: test
      python: "3.7"
      before_install: pip install tox
      script: make test
      dist: xenial

    - python: "3.6"
      before_install: pip install tox
      script: make test
      dist: xenial

    - python: pypy3
      before_install: pip install tox
      script: make test
      dist: xenial

#    - stage: deploy
#      script: python setup.py sdist
#      deploy:
#        provider: pypi
#        user: "__token__"
#        on:
#          tags: true
#          repo: boxed/hammett
